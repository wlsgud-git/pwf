{"ast":null,"code":"import{useEffect,useRef,useState}from\"react\";import\"../../css/modal/streamRoom.css\";import{emitter}from\"../../util/event\";// types\nimport{stream_service}from\"../../service/streamservice\";import{createFormData}from\"../../util/form\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";// 초대할 친구정보\nexport const LiFriend=_ref=>{let{user}=_ref;let[select,Setselect]=useState(false);const selectControl=()=>Setselect(c=>!c);// 강제 select 제거\nuseEffect(()=>{const handler=()=>{Setselect(false);};emitter.on(`${user.nickname} select off`,handler);return()=>{emitter.off(`${user.nickname} select off`,handler);};},[]);useEffect(()=>{emitter.emit(\"invite select\",{select,user});},[select]);return/*#__PURE__*/_jsxs(\"li\",{className:\"invite_friend_li\",children:[/*#__PURE__*/_jsx(\"input\",{id:user.nickname,type:\"radio\",checked:select,value:user.nickname,onClick:selectControl}),/*#__PURE__*/_jsx(\"span\",{className:\"invite_friend_img\",children:/*#__PURE__*/_jsx(\"img\",{src:user.profile_img})}),/*#__PURE__*/_jsx(\"span\",{className:\"invite_friend_nickname\",children:user.nickname})]});};// 방 만들기 모달\nexport const StreamRoom=_ref2=>{let{user,type}=_ref2;let formRef=useRef(null);let[inviteUsers,setInviteUsers]=useState([]);// infomation\nlet[roomname,setRoomname]=useState(\"\");// 모달 리셋\nfunction resetModal(){setRoomname(\"\");inviteUsers.map(val=>{emitter.emit(`${val.nickname} select off`);});emitter.emit(\"modal\",{type});}// invite\nuseEffect(()=>{const handler=data=>{let{select,user}=data;if(select)setInviteUsers(c=>[...c,user]);else setInviteUsers(c=>c.filter(data=>data.nickname!==user.nickname));};emitter.on(\"invite select\",handler);return()=>{emitter.off(\"invite select\",handler);};},[]);// 방 생성\nconst createStreamRoom=async e=>{e.preventDefault();if(!roomname.length||roomname.length>=21){alert(\"방 이름은 1~20자 이내여야 합니다.\");return;}if(!inviteUsers.length){alert(\"최소 1명이상의 친구를 초대해야 합니다.\");return;}try{let participants=inviteUsers.map(val=>val.id);participants.push(user.id);let formdata=createFormData({room_name:roomname,participants});let{msg,room}=await stream_service.createStreamRoom(formdata);resetModal();}catch(err){alert(err);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"stream_modal\",style:{display:type==\"stream\"?\"flex\":\"none\"},children:[/*#__PURE__*/_jsx(\"header\",{className:\"modal_header\",children:/*#__PURE__*/_jsx(\"button\",{onClick:resetModal,children:\"X\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"stream_create_box\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:createStreamRoom,ref:formRef,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stream_roomname_box\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"stream_roomname\",children:\"\\uBC29\\uC774\\uB984\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:roomname,className:\"pwf_roomname_input\",placeholder:\"\\uBC29\\uC774\\uB984\",onChange:e=>setRoomname(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"participants_box\",children:[/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"participants\",children:[\"\\uCC38\\uC5EC\\uC790 \",inviteUsers.length]}),/*#__PURE__*/_jsx(\"ul\",{className:\"participants_list\",children:inviteUsers.length?inviteUsers.map(val=>/*#__PURE__*/_jsx(\"li\",{children:val.nickname})):/*#__PURE__*/_jsx(\"p\",{style:{color:\"gray\"},children:\"\\uCD08\\uB300\\uB41C \\uCE5C\\uAD6C\\uAC00 \\uC5C6\\uC2B5\\uB2C8\\uB2E4\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"friends_invite_box\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"friends_list\",children:\"\\uCE5C\\uAD6C\\uBAA9\\uB85D\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"friends_list\",children:user.friends&&user.friends.length?user.friends.map(val=>/*#__PURE__*/_jsx(LiFriend,{user:val})):/*#__PURE__*/_jsx(\"p\",{children:\"\\uCD08\\uB300\\uD560 \\uCE5C\\uAD6C\\uAC00 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"})})]}),/*#__PURE__*/_jsx(\"footer\",{className:\"stream_modal_footer\",children:/*#__PURE__*/_jsx(\"button\",{children:\"\\uBC29 \\uB9CC\\uB4E4\\uAE30\"})})]})})]});};","map":{"version":3,"names":["useEffect","useRef","useState","emitter","stream_service","createFormData","jsx","_jsx","jsxs","_jsxs","LiFriend","_ref","user","select","Setselect","selectControl","c","handler","on","nickname","off","emit","className","children","id","type","checked","value","onClick","src","profile_img","StreamRoom","_ref2","formRef","inviteUsers","setInviteUsers","roomname","setRoomname","resetModal","map","val","data","filter","createStreamRoom","e","preventDefault","length","alert","participants","push","formdata","room_name","msg","room","err","style","display","onSubmit","ref","htmlFor","placeholder","onChange","target","color","friends"],"sources":["C:/Users/ashh1/Desktop/project/PlayWithFriends/client/src/components/modal/streamRoom.tsx"],"sourcesContent":["import { ChangeEvent, useEffect, useRef, useState } from \"react\";\r\nimport \"../../css/modal/streamRoom.css\";\r\nimport { emitter } from \"../../util/event\";\r\n\r\n// types\r\nimport { User, UserComponent } from \"../../types/user\";\r\nimport { FormSubmit, InputChange } from \"../../types/event\";\r\nimport { stream_service } from \"../../service/streamservice\";\r\nimport { createFormData } from \"../../util/form\";\r\n\r\ninterface CompoentProps {\r\n  user: User;\r\n  type: string;\r\n}\r\n\r\n// 초대할 친구정보\r\nexport const LiFriend = ({ user }: { [user: string]: User }) => {\r\n  let [select, Setselect] = useState<boolean>(false);\r\n\r\n  const selectControl = () => Setselect((c) => !c);\r\n\r\n  // 강제 select 제거\r\n  useEffect(() => {\r\n    const handler = () => {\r\n      Setselect(false);\r\n    };\r\n\r\n    emitter.on(`${user.nickname} select off`, handler);\r\n\r\n    return () => {\r\n      emitter.off(`${user.nickname} select off`, handler);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    emitter.emit(\"invite select\", { select, user });\r\n  }, [select]);\r\n\r\n  return (\r\n    <li className=\"invite_friend_li\">\r\n      <input\r\n        id={user.nickname}\r\n        type=\"radio\"\r\n        checked={select}\r\n        value={user.nickname}\r\n        onClick={selectControl}\r\n      />\r\n      <span className=\"invite_friend_img\">\r\n        <img src={user.profile_img} />\r\n      </span>\r\n      <span className=\"invite_friend_nickname\">{user.nickname}</span>\r\n    </li>\r\n  );\r\n};\r\n\r\n// 방 만들기 모달\r\nexport const StreamRoom = ({ user, type }: CompoentProps) => {\r\n  let formRef = useRef<HTMLFormElement>(null);\r\n  let [inviteUsers, setInviteUsers] = useState<User[]>([]);\r\n\r\n  // infomation\r\n  let [roomname, setRoomname] = useState<string>(\"\");\r\n\r\n  // 모달 리셋\r\n  function resetModal() {\r\n    setRoomname(\"\");\r\n    inviteUsers.map((val) => {\r\n      emitter.emit(`${val.nickname} select off`);\r\n    });\r\n    emitter.emit(\"modal\", { type });\r\n  }\r\n\r\n  // invite\r\n  useEffect(() => {\r\n    const handler = (data: any) => {\r\n      let { select, user } = data;\r\n\r\n      if (select) setInviteUsers((c) => [...c, user]);\r\n      else\r\n        setInviteUsers((c) =>\r\n          c.filter((data: User) => data.nickname !== user.nickname)\r\n        );\r\n    };\r\n\r\n    emitter.on(\"invite select\", handler);\r\n\r\n    return () => {\r\n      emitter.off(\"invite select\", handler);\r\n    };\r\n  }, []);\r\n\r\n  // 방 생성\r\n  const createStreamRoom = async (e: FormSubmit) => {\r\n    e.preventDefault();\r\n\r\n    if (!roomname.length || roomname.length >= 21) {\r\n      alert(\"방 이름은 1~20자 이내여야 합니다.\");\r\n      return;\r\n    }\r\n\r\n    if (!inviteUsers.length) {\r\n      alert(\"최소 1명이상의 친구를 초대해야 합니다.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      let participants = inviteUsers.map((val) => val.id);\r\n      participants.push(user.id);\r\n      let formdata = createFormData({ room_name: roomname, participants });\r\n      let { msg, room } = await stream_service.createStreamRoom(formdata);\r\n      resetModal();\r\n    } catch (err) {\r\n      alert(err);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className=\"stream_modal\"\r\n      style={{ display: type == \"stream\" ? \"flex\" : \"none\" }}\r\n    >\r\n      <header className=\"modal_header\">\r\n        <button onClick={resetModal}>X</button>\r\n      </header>\r\n      {/* 모달 내용 */}\r\n      <div className=\"stream_create_box\">\r\n        <form onSubmit={createStreamRoom} ref={formRef}>\r\n          {/* 방 이름 */}\r\n          <div className=\"stream_roomname_box\">\r\n            <label htmlFor=\"stream_roomname\">방이름</label>\r\n            <input\r\n              type=\"text\"\r\n              value={roomname}\r\n              className=\"pwf_roomname_input\"\r\n              placeholder=\"방이름\"\r\n              onChange={(e: InputChange) => setRoomname(e.target.value)}\r\n            />\r\n          </div>\r\n          {/* 참여자 목록 */}\r\n          <div className=\"participants_box\">\r\n            <label htmlFor=\"participants\">참여자 {inviteUsers.length}</label>\r\n            <ul className=\"participants_list\">\r\n              {inviteUsers.length ? (\r\n                inviteUsers.map((val) => <li>{val.nickname}</li>)\r\n              ) : (\r\n                <p style={{ color: \"gray\" }}>초대된 친구가 없습니다</p>\r\n              )}\r\n            </ul>\r\n          </div>\r\n          {/* 초대할 친구목록 */}\r\n          <div className=\"friends_invite_box\">\r\n            <label htmlFor=\"friends_list\">친구목록</label>\r\n            <ul className=\"friends_list\">\r\n              {user.friends && user.friends.length ? (\r\n                user.friends.map((val) => <LiFriend user={val} />)\r\n              ) : (\r\n                <p>초대할 친구가 없습니다.</p>\r\n              )}\r\n            </ul>\r\n          </div>\r\n          {/* 모달 풋터 */}\r\n          <footer className=\"stream_modal_footer\">\r\n            <button>방 만들기</button>\r\n          </footer>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n"],"mappings":"AAAA,OAAsBA,SAAS,CAAEC,MAAM,CAAEC,QAAQ,KAAQ,OAAO,CAChE,MAAO,gCAAgC,CACvC,OAASC,OAAO,KAAQ,kBAAkB,CAE1C;AAGA,OAASC,cAAc,KAAQ,6BAA6B,CAC5D,OAASC,cAAc,KAAQ,iBAAiB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAOjD;AACA,MAAO,MAAM,CAAAC,QAAQ,CAAGC,IAAA,EAAwC,IAAvC,CAAEC,IAA+B,CAAC,CAAAD,IAAA,CACzD,GAAI,CAACE,MAAM,CAAEC,SAAS,CAAC,CAAGZ,QAAQ,CAAU,KAAK,CAAC,CAElD,KAAM,CAAAa,aAAa,CAAGA,CAAA,GAAMD,SAAS,CAAEE,CAAC,EAAK,CAACA,CAAC,CAAC,CAEhD;AACAhB,SAAS,CAAC,IAAM,CACd,KAAM,CAAAiB,OAAO,CAAGA,CAAA,GAAM,CACpBH,SAAS,CAAC,KAAK,CAAC,CAClB,CAAC,CAEDX,OAAO,CAACe,EAAE,CAAC,GAAGN,IAAI,CAACO,QAAQ,aAAa,CAAEF,OAAO,CAAC,CAElD,MAAO,IAAM,CACXd,OAAO,CAACiB,GAAG,CAAC,GAAGR,IAAI,CAACO,QAAQ,aAAa,CAAEF,OAAO,CAAC,CACrD,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAENjB,SAAS,CAAC,IAAM,CACdG,OAAO,CAACkB,IAAI,CAAC,eAAe,CAAE,CAAER,MAAM,CAAED,IAAK,CAAC,CAAC,CACjD,CAAC,CAAE,CAACC,MAAM,CAAC,CAAC,CAEZ,mBACEJ,KAAA,OAAIa,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAC9BhB,IAAA,UACEiB,EAAE,CAAEZ,IAAI,CAACO,QAAS,CAClBM,IAAI,CAAC,OAAO,CACZC,OAAO,CAAEb,MAAO,CAChBc,KAAK,CAAEf,IAAI,CAACO,QAAS,CACrBS,OAAO,CAAEb,aAAc,CACxB,CAAC,cACFR,IAAA,SAAMe,SAAS,CAAC,mBAAmB,CAAAC,QAAA,cACjChB,IAAA,QAAKsB,GAAG,CAAEjB,IAAI,CAACkB,WAAY,CAAE,CAAC,CAC1B,CAAC,cACPvB,IAAA,SAAMe,SAAS,CAAC,wBAAwB,CAAAC,QAAA,CAAEX,IAAI,CAACO,QAAQ,CAAO,CAAC,EAC7D,CAAC,CAET,CAAC,CAED;AACA,MAAO,MAAM,CAAAY,UAAU,CAAGC,KAAA,EAAmC,IAAlC,CAAEpB,IAAI,CAAEa,IAAoB,CAAC,CAAAO,KAAA,CACtD,GAAI,CAAAC,OAAO,CAAGhC,MAAM,CAAkB,IAAI,CAAC,CAC3C,GAAI,CAACiC,WAAW,CAAEC,cAAc,CAAC,CAAGjC,QAAQ,CAAS,EAAE,CAAC,CAExD;AACA,GAAI,CAACkC,QAAQ,CAAEC,WAAW,CAAC,CAAGnC,QAAQ,CAAS,EAAE,CAAC,CAElD;AACA,QAAS,CAAAoC,UAAUA,CAAA,CAAG,CACpBD,WAAW,CAAC,EAAE,CAAC,CACfH,WAAW,CAACK,GAAG,CAAEC,GAAG,EAAK,CACvBrC,OAAO,CAACkB,IAAI,CAAC,GAAGmB,GAAG,CAACrB,QAAQ,aAAa,CAAC,CAC5C,CAAC,CAAC,CACFhB,OAAO,CAACkB,IAAI,CAAC,OAAO,CAAE,CAAEI,IAAK,CAAC,CAAC,CACjC,CAEA;AACAzB,SAAS,CAAC,IAAM,CACd,KAAM,CAAAiB,OAAO,CAAIwB,IAAS,EAAK,CAC7B,GAAI,CAAE5B,MAAM,CAAED,IAAK,CAAC,CAAG6B,IAAI,CAE3B,GAAI5B,MAAM,CAAEsB,cAAc,CAAEnB,CAAC,EAAK,CAAC,GAAGA,CAAC,CAAEJ,IAAI,CAAC,CAAC,CAAC,IAE9C,CAAAuB,cAAc,CAAEnB,CAAC,EACfA,CAAC,CAAC0B,MAAM,CAAED,IAAU,EAAKA,IAAI,CAACtB,QAAQ,GAAKP,IAAI,CAACO,QAAQ,CAC1D,CAAC,CACL,CAAC,CAEDhB,OAAO,CAACe,EAAE,CAAC,eAAe,CAAED,OAAO,CAAC,CAEpC,MAAO,IAAM,CACXd,OAAO,CAACiB,GAAG,CAAC,eAAe,CAAEH,OAAO,CAAC,CACvC,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAA0B,gBAAgB,CAAG,KAAO,CAAAC,CAAa,EAAK,CAChDA,CAAC,CAACC,cAAc,CAAC,CAAC,CAElB,GAAI,CAACT,QAAQ,CAACU,MAAM,EAAIV,QAAQ,CAACU,MAAM,EAAI,EAAE,CAAE,CAC7CC,KAAK,CAAC,uBAAuB,CAAC,CAC9B,OACF,CAEA,GAAI,CAACb,WAAW,CAACY,MAAM,CAAE,CACvBC,KAAK,CAAC,wBAAwB,CAAC,CAC/B,OACF,CAEA,GAAI,CACF,GAAI,CAAAC,YAAY,CAAGd,WAAW,CAACK,GAAG,CAAEC,GAAG,EAAKA,GAAG,CAAChB,EAAE,CAAC,CACnDwB,YAAY,CAACC,IAAI,CAACrC,IAAI,CAACY,EAAE,CAAC,CAC1B,GAAI,CAAA0B,QAAQ,CAAG7C,cAAc,CAAC,CAAE8C,SAAS,CAAEf,QAAQ,CAAEY,YAAa,CAAC,CAAC,CACpE,GAAI,CAAEI,GAAG,CAAEC,IAAK,CAAC,CAAG,KAAM,CAAAjD,cAAc,CAACuC,gBAAgB,CAACO,QAAQ,CAAC,CACnEZ,UAAU,CAAC,CAAC,CACd,CAAE,MAAOgB,GAAG,CAAE,CACZP,KAAK,CAACO,GAAG,CAAC,CACZ,CACF,CAAC,CAED,mBACE7C,KAAA,QACEa,SAAS,CAAC,cAAc,CACxBiC,KAAK,CAAE,CAAEC,OAAO,CAAE/B,IAAI,EAAI,QAAQ,CAAG,MAAM,CAAG,MAAO,CAAE,CAAAF,QAAA,eAEvDhB,IAAA,WAAQe,SAAS,CAAC,cAAc,CAAAC,QAAA,cAC9BhB,IAAA,WAAQqB,OAAO,CAAEU,UAAW,CAAAf,QAAA,CAAC,GAAC,CAAQ,CAAC,CACjC,CAAC,cAEThB,IAAA,QAAKe,SAAS,CAAC,mBAAmB,CAAAC,QAAA,cAChCd,KAAA,SAAMgD,QAAQ,CAAEd,gBAAiB,CAACe,GAAG,CAAEzB,OAAQ,CAAAV,QAAA,eAE7Cd,KAAA,QAAKa,SAAS,CAAC,qBAAqB,CAAAC,QAAA,eAClChB,IAAA,UAAOoD,OAAO,CAAC,iBAAiB,CAAApC,QAAA,CAAC,oBAAG,CAAO,CAAC,cAC5ChB,IAAA,UACEkB,IAAI,CAAC,MAAM,CACXE,KAAK,CAAES,QAAS,CAChBd,SAAS,CAAC,oBAAoB,CAC9BsC,WAAW,CAAC,oBAAK,CACjBC,QAAQ,CAAGjB,CAAc,EAAKP,WAAW,CAACO,CAAC,CAACkB,MAAM,CAACnC,KAAK,CAAE,CAC3D,CAAC,EACC,CAAC,cAENlB,KAAA,QAAKa,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAC/Bd,KAAA,UAAOkD,OAAO,CAAC,cAAc,CAAApC,QAAA,EAAC,qBAAI,CAACW,WAAW,CAACY,MAAM,EAAQ,CAAC,cAC9DvC,IAAA,OAAIe,SAAS,CAAC,mBAAmB,CAAAC,QAAA,CAC9BW,WAAW,CAACY,MAAM,CACjBZ,WAAW,CAACK,GAAG,CAAEC,GAAG,eAAKjC,IAAA,OAAAgB,QAAA,CAAKiB,GAAG,CAACrB,QAAQ,CAAK,CAAC,CAAC,cAEjDZ,IAAA,MAAGgD,KAAK,CAAE,CAAEQ,KAAK,CAAE,MAAO,CAAE,CAAAxC,QAAA,CAAC,gEAAY,CAAG,CAC7C,CACC,CAAC,EACF,CAAC,cAENd,KAAA,QAAKa,SAAS,CAAC,oBAAoB,CAAAC,QAAA,eACjChB,IAAA,UAAOoD,OAAO,CAAC,cAAc,CAAApC,QAAA,CAAC,0BAAI,CAAO,CAAC,cAC1ChB,IAAA,OAAIe,SAAS,CAAC,cAAc,CAAAC,QAAA,CACzBX,IAAI,CAACoD,OAAO,EAAIpD,IAAI,CAACoD,OAAO,CAAClB,MAAM,CAClClC,IAAI,CAACoD,OAAO,CAACzB,GAAG,CAAEC,GAAG,eAAKjC,IAAA,CAACG,QAAQ,EAACE,IAAI,CAAE4B,GAAI,CAAE,CAAC,CAAC,cAElDjC,IAAA,MAAAgB,QAAA,CAAG,iEAAa,CAAG,CACpB,CACC,CAAC,EACF,CAAC,cAENhB,IAAA,WAAQe,SAAS,CAAC,qBAAqB,CAAAC,QAAA,cACrChB,IAAA,WAAAgB,QAAA,CAAQ,2BAAK,CAAQ,CAAC,CAChB,CAAC,EACL,CAAC,CACJ,CAAC,EACH,CAAC,CAEV,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}