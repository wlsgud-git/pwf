{"ast":null,"code":"// library\nimport { createSlice } from \"@reduxjs/toolkit\";\nimport { userAction } from \"../actions/userAction\";\n\n// type\n\nimport { userSocket } from \"../../util/socket\";\nconst initialState = {\n  id: 0,\n  nickname: \"\",\n  profile_img: \"\",\n  email: \"\"\n};\nconst userSlice = createSlice({\n  name: \"user\",\n  initialState,\n  // reducer\n  reducers: {\n    onlineUpdate: (current, data) => {\n      let {\n        nickname,\n        online\n      } = data.payload;\n      return {\n        ...current,\n        friends: current.friends.map(val => val.nickname == nickname ? {\n          ...val,\n          online\n        } : val)\n      };\n    },\n    insertReceiver: (current, data) => {\n      let {\n        nickname,\n        profile_img,\n        online\n      } = data.payload;\n      return {\n        ...current,\n        friends: [...current.friends, data.payload]\n      };\n    },\n    userInit: current => current = initialState\n  },\n  // actions\n  extraReducers: builder => {\n    // 세션으로 유저 정보 가져오기\n    builder.addCase(userAction.getUserAction.fulfilled, (state, action) => {\n      let {\n        id,\n        email,\n        nickname,\n        profile_img,\n        request_friend_list,\n        friends,\n        stream_room\n      } = action.payload;\n      state.id = id;\n      state.email = email;\n      state.profile_img = profile_img;\n      state.nickname = nickname;\n      if (request_friend_list && request_friend_list.length) state.request_friends = request_friend_list.map(val => val);\n      if (friends && friends.length) state.friends = friends.map(val => val);\n      if (stream_room && stream_room.length) state.stream_room = stream_room.map(val => val);\n      userSocket();\n      // return state;\n    });\n\n    // 친구요청에 대한 결과\n    builder.addCase(userAction.requestFriendHandle.fulfilled, (state, action) => {\n      var _state$request_friend;\n      let {\n        sender,\n        msg\n      } = action.payload;\n      state.request_friends = (_state$request_friend = state.request_friends) === null || _state$request_friend === void 0 ? void 0 : _state$request_friend.filter(val => {\n        var _state$friends;\n        if (val.nickname == sender.nickname) (_state$friends = state.friends) === null || _state$friends === void 0 ? void 0 : _state$friends.push(sender);\n        return val.nickname != sender.nickname;\n      });\n      alert(msg);\n      return;\n    });\n  }\n});\nexport const {\n  onlineUpdate,\n  insertReceiver,\n  userInit\n} = userSlice.actions;\nexport default userSlice.reducer;","map":{"version":3,"names":["createSlice","userAction","userSocket","initialState","id","nickname","profile_img","email","userSlice","name","reducers","onlineUpdate","current","data","online","payload","friends","map","val","insertReceiver","userInit","extraReducers","builder","addCase","getUserAction","fulfilled","state","action","request_friend_list","stream_room","length","request_friends","requestFriendHandle","_state$request_friend","sender","msg","filter","_state$friends","push","alert","actions","reducer"],"sources":["C:/Users/ashh1/Desktop/project/PlayWithFriends/client/src/redux/reducer/userReducer.ts"],"sourcesContent":["// library\r\nimport { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\r\n\r\nimport { userAction } from \"../actions/userAction\";\r\n\r\n// type\r\nimport { FriendOnlineStatus, User } from \"../../types/user\";\r\nimport { Room } from \"../../types/room\";\r\nimport { userSocket } from \"../../util/socket\";\r\n\r\nconst initialState: User = {\r\n  id: 0,\r\n  nickname: \"\",\r\n  profile_img: \"\",\r\n  email: \"\",\r\n};\r\n\r\nconst userSlice = createSlice({\r\n  name: \"user\",\r\n  initialState, // reducer\r\n  reducers: {\r\n    onlineUpdate: (current: any, data: PayloadAction<User>) => {\r\n      let { nickname, online } = data.payload;\r\n      return {\r\n        ...current,\r\n        friends: current.friends.map((val: User) =>\r\n          val.nickname == nickname ? { ...val, online } : val\r\n        ),\r\n      };\r\n    },\r\n\r\n    insertReceiver: (current: any, data: PayloadAction<User>) => {\r\n      let { nickname, profile_img, online } = data.payload;\r\n\r\n      return { ...current, friends: [...current.friends, data.payload] };\r\n    },\r\n\r\n    userInit: (current: any) => (current = initialState),\r\n  },\r\n\r\n  // actions\r\n  extraReducers: (builder) => {\r\n    // 세션으로 유저 정보 가져오기\r\n    builder.addCase(userAction.getUserAction.fulfilled, (state, action) => {\r\n      let {\r\n        id,\r\n        email,\r\n        nickname,\r\n        profile_img,\r\n        request_friend_list,\r\n        friends,\r\n        stream_room,\r\n      } = action.payload;\r\n\r\n      state.id = id;\r\n      state.email = email;\r\n      state.profile_img = profile_img;\r\n      state.nickname = nickname;\r\n\r\n      if (request_friend_list && request_friend_list.length)\r\n        state.request_friends = request_friend_list.map((val: User) => val);\r\n      if (friends && friends.length)\r\n        state.friends = friends.map((val: User) => val);\r\n      if (stream_room && stream_room.length)\r\n        state.stream_room = stream_room.map((val: Room) => val);\r\n      userSocket();\r\n      // return state;\r\n    });\r\n\r\n    // 친구요청에 대한 결과\r\n    builder.addCase(\r\n      userAction.requestFriendHandle.fulfilled,\r\n      (state, action) => {\r\n        let { sender, msg } = action.payload;\r\n\r\n        state.request_friends = state.request_friends?.filter((val) => {\r\n          if (val.nickname == sender.nickname) state.friends?.push(sender);\r\n          return val.nickname != sender.nickname;\r\n        });\r\n\r\n        alert(msg);\r\n        return;\r\n      }\r\n    );\r\n  },\r\n});\r\n\r\nexport const { onlineUpdate, insertReceiver, userInit } = userSlice.actions;\r\nexport default userSlice.reducer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}